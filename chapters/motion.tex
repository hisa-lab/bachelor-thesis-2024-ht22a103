%! TEX root = ../main.tex
\documentclass[main]{subfiles}

\begin{document}
\chapter{開発するWebアプリケーションの動作}
\label{cha:motion}
本章では\ref{cha:overview}章で述べた、アプリケーションの機能の動作や使用した際の流れを記述する。

\section{アプリケーション使用の際の流れ}

本アプリケーションを使用する際の全体的な流れについて説明する。
まず、ユーザーはレシート画像をアップロードすることで、OCR技術を利用して品目、金額、日付などの情報を自動的に抽出する。
アップロードされたレシート画像は、OCRを用いて解析され、支出情報が構造化された形式で取得される

次に、OCR処理で抽出された支出データがアプリケーション内に登録される。
ユーザーは必要に応じて、品目名や金額、日付の編集を行い、データを正確な形に整えることができる。
また、支出データにカテゴリを手動で入力することで、個別の分類が可能となる。
この分類機能により、支出情報を視覚的かつ論理的に整理することができる。

その後、登録された支出データは、カレンダー機能を通じて日付ごとに整理される。
ユーザーはカレンダーから任意の日付を選択し、その日の支出情報や合計金額を確認することが可能である。
また、日付単位の情報だけでなく、カテゴリごとの支出合計も確認できるため、消費パターンを多角的に分析することができる。

最後に、視覚化されたデータは、支出の合計金額をカテゴリ別や日付別に表示し、ユーザーに直感的な消費状況の把握を可能にする。
これにより、日常的な家計管理から長期的な消費傾向の分析まで幅広く活用できる仕組みとなっている。

\section{画像アップロード時の動作}

ユーザーはレシート画像をアップロードすることで、OCR技術を用いて品目、金額、および日付を自動的に抽出する。
レシート画像のアップロードは、専用のインターフェースを通じて実行される。
ユーザーはデバイスから画像を選択し、アップロードボタンをクリックすることで、OCR処理が開始される。

% \subsection{OCRについて}

% OCR（Optical Character Recognition、光学文字認識）は、画像内の文字情報を抽出する技術を指します。
% この技術は、スキャンされた文書、写真、レシート、名刺などの画像形式で保存されたテキストをデジタルデータとして取り込むために使用されます。
% 本アプリケーションのシステムでは、オープンソースのOCRエンジンであるTesseract OCRを採用している。
% Tesseract OCRは、高い認識精度を持つ光学文字認識ライブラリであり、多言語対応が可能である。
% 本システムでは、日本語のレシートを対象としているため、日本語モデル（jpn）を用いてOCR処理を実行している。
% OCR処理では、アップロードされたレシート画像から文字情報を解析し、品目名、金額、日付などの構造化された支出情報を抽出する。
% さすがに OCR は説明する必要ない。。。

\subsection{写真をアップロードした際の動作}
% OCRでは写真をアップロードしない。

実際にレシート写真をアップロードするプロセスについて説明する。
使用するレシート写真を図\ref{fig:receipt}に示す。
この図は、OCR処理を行う対象となるレシート画像である。

まず、図\ref{fig:receipt}に示すレシート写真を「画像を選択」ボタンから選択する。
その後、アップロードボタンをクリックすることでOCR処理が開始される。この操作を説明した画面を図\ref{fig:upload}に示す。
OCR処理が実行されると、図\ref{fig:receipt}のレシート画像からテキストデータが抽出される。
このOCR解析結果を図\ref{fig:OCRresult}に示す。
図\ref{fig:OCRresult}では、レシートに記載されている品目名、金額、日付などの情報がテキスト形式で表示されていることがわかる。
この抽出されたテキストデータは、本システムによって行単位で解析される。
行単位とは、OCRで生成された生テキストを「1行ごと」に区切り、その各行を解析の基本単位として処理する方法を指す。

具体的には、OCR処理によって得られたテキストデータには改行文字が含まれており、この改行文字を基にテキストを分割し、品目名や金額を抽出する。
このプロセスにより、ユーザーはレシートに記載された情報を効率的にデジタル化し、
品目名、金額、日付などを正確に家計簿データとして記録することが可能となる。

しかし、OCR技術の精度はレシートの印刷状態や画像の品質に依存するため、文字が正しく抽出されない場合がある。
このような場合には、品目名、金額、日付を手動で入力できるインターフェースを提供している、その図が\ref{fig:input}。
この手動入力インターフェースは、OCRの抽出結果が不完全である場合の補完手段として機能し、
ユーザーが正確な支出記録を保持できるように設計されている。

\begin{figure}[tb]
    \begin{center}
        \fbox{
            \includegraphics[width=.8\linewidth]%
            {../figures/receipt.jpeg}
        }
        \caption{レシート写真の例　receipt.jpeg}
        \label{fig:receipt}
    \end{center}
\end{figure}

\begin{figure}[tb]
    \begin{center}
        \fbox{
            \includegraphics[width=.8\linewidth]%
            {../figures/upload.png}
        }
        \caption{画像のアップロード方法}
        \label{fig:upload}
    \end{center}
\end{figure}

\begin{figure}[tb]
    \begin{center}
        \fbox{
            \includegraphics[width=.8\linewidth]%
            {../figures/OCRresult.png}
        }
        \caption{OCR解析結果}
        \label{fig:OCRresult}
    \end{center}
\end{figure}

\begin{figure}[tb]
    \begin{center}
        \fbox{
            \includegraphics[width=.8\linewidth]%
            {../figures/input.png}
        }
        \caption{手動で入力場合の入力欄}
        \label{fig:input}
    \end{center}
\end{figure}


\section{支出データの登録、編集、および分類}

次に、抽出されたデータの登録や編集、分類について説明する。
図\ref{fig:Registration}に、OCR処理や手動入力により取得された支出データをアプリケーション内に登録した後の画面を示す。
この図に示されるように、登録されたデータは品目名、金額、日付、カテゴリの4つの要素で構成される。
OCRによって自動的に取得されたデータは、ユーザーが必要に応じて品目や金額、
日付を編集できる設計となっており、これによりOCRの誤認識や手動入力時のミスを修正することが可能である。

さらに、登録されたデータにはカテゴリを割り当てる機能があり、図\ref{fig:classification}にその例を示す。
この図に示されるように、カテゴリは「食費」「交通費」「娯楽」などの形式でユーザーが自由に入力できるため、
支出データを視覚的かつ論理的に分類できる。この機能は、ユーザーのニーズに応じた柔軟な分類を可能にする。
そして、登録された支出データは日付ごとに整理され、カレンダー機能を用いて特定の日付の支出を簡単に確認できる。
この設計により、支出の発生時期や用途を把握するためのデータ管理が容易になると同時に、日次、月次の集計や分析が可能となっている。


\begin{figure}[tb]
    \begin{center}
        \fbox{
            \includegraphics[width=.8\linewidth]%
            {../figures/Registration.png}
        }
        \caption{支出を表示した図}
        \label{fig:Registration}
    \end{center}
\end{figure}

\begin{figure}[tb]
    \begin{center}
        \fbox{
            \includegraphics[width=.8\linewidth]%
            {../figures/classification.png}
        }
        \caption{カテゴリ欄に入力}
        \label{fig:classification}
    \end{center}
\end{figure}

\begin{figure}[tb]
    \begin{center}
        \fbox{
            \includegraphics[width=.8\linewidth]%
            {../figures/category_total.png}
        }
        \caption{カテゴリごとの合計}
        \label{fig:category_total}
    \end{center}
\end{figure}

\begin{figure}[tb]
    \begin{center}
        \fbox{
            \includegraphics[width=.8\linewidth]%
            {../figures/date_total.png}
        }
        \caption{日付ごとの合計}
        \label{fig:date_total}
    \end{center}
\end{figure}

\section{合計金額表示機能の動作}

次に、本システムの合計金額表示機能について説明する。
この機能は、登録された支出データを基に、カテゴリごとや日付ごとの合計金額を計算し、それらをユーザーに視覚的に提示するものである。
具体的には、支出データが登録されると、自動的にカテゴリや日付ごとに分類され、各カテゴリまたは各日付に対応する合計金額が算出される。
これらの合計金額は、表形式で表示されるため、ユーザーは直感的に確認することができる。
特に、日付ごとの合計金額表示機能は、日々の支出を追跡し、予算管理をサポートする上で有用である。
また、カテゴリごとの合計金額表示は、どの支出カテゴリに最も多くの金額が費やされているかを一目で把握することが可能である。

この設計により、ユーザーは支出データを単に記録するだけでなく、
そのデータを分析し、消費パターンを把握するための具体的な手がかりを得ることができる。
本機能は、支出情報の視覚化とユーザーの意思決定を支援するための重要な役割を果たしている。

\section{カレンダー機能の動作と役割}

本システムのカレンダー機能は、日付ごとの支出データを簡単に記録及び管理できるインターフェースを提供する。
ユーザーはカレンダーで日付を選択するだけで、その日に記録された支出データを確認できる。
また、特定の日付の支出情報をカテゴリごとに分けたり、合計金額を表示したりすることで、その日の消費状況を把握しやすくしている。
さらに、過去の支出データにも簡単にアクセスできるため、長期的な消費傾向の分析にも役立てることができる。

図\ref{fig:12-15}に、2024年12月15日の支出データがカレンダー機能を通じて表示された例を示す。
この図では、ユーザーがカレンダーで2024年12月15日を選択した際に、
その日付に紐付けられた支出項目、金額、カテゴリ、およびその合計金額が画面に表示されている様子が確認できる。
この機能により、ユーザーは特定の日付に記録された支出を一目で把握することができる。

次に、図\ref{fig:12-14}に2024年12月14日の支出データが表示された例を示す。
この図は、ユーザーが選択日付を2024年12月15日から2024年12月14日に変更した際の画面であり、
選択日付に応じて表示されるデータが即座に更新されることを示している。

支出データは「日付」をキーとして保存されており、OCR処理によって抽出された日付情報を基に自動的に紐付けられる。
さらに、OCRで日付が取得できなかった場合には、手動で日付を入力するインターフェースが提供されており、図\ref{fig:manual-date}にその例を示す。
この設計により、OCR処理が不完全な場合でも、正確な日付情報を持つ支出データを登録することが可能であり、
データの完全性とユーザーの利便性が確保される。

\begin{figure}[tb]
    \begin{center}
        \fbox{
            \includegraphics[width=.8\linewidth]%
            {../figures/12-15.png}
        }
        \caption{2024年12月15日の支出}
        \label{fig:12-15}
    \end{center}
\end{figure}

\begin{figure}[tb]
    \begin{center}
        \fbox{
            \includegraphics[width=.8\linewidth]%
            {../figures/12-14.png}
        }
        \caption{2024年12月14日の支出}
        \label{fig:12-14}
    \end{center}
\end{figure}

\end{document}